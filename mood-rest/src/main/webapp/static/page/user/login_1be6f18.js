define("page/user/login",["require","exports","module","components/app/app","components/app/api"],function(e,s,r){{var o=e("components/app/app"),t=e("components/app/api");new Vue({el:"#Login",data:function(){var e=this,s=function(e,s,r){var o=s.trim();/^1[34578]\d{9}$/.test(o)?r():r(new Error("请输入正确的手机号"))},r=function(s,r,o){var t;e.register?t=e.registerRuleForm.password:e.forget&&(t=e.forgetRuleForm.password);var i=r.trim();console.log(i,t),i!==t?o(new Error("两次密码不一致")):o()};return{login:!0,forget:!1,register:!1,dialogLogin:!1,loginRuleForm:{username:"",pwd:""},forgetRuleForm:{mobile:"",code:"",password:"",passwordNext:""},registerRuleForm:{mobile:"",code:"",password:"",passwordNext:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码不能小于6位",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:s,trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码不能小于6位",trigger:"blur"}],passwordNext:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:r,trigger:"blur"}]},submit:{formTitle:"登录",loading:!1,loginText:"登录",forgetText:"提交",registerText:"注册",getCode:"获取验证码"}}},mounted:function(){var e=this;$("#goLogin").click(function(){e.dialogLogin=!0}),$("#quit").click(function(){e.quit()})},methods:{dialogLoginClose:function(){this.dialogLogin=!1,this.login?this.resetForm("loginRuleForm"):this.forget?this.resetForm("forgetRuleForm"):this.register&&this.resetForm("registerRuleForm")},quit:function(){var e=this;this.$confirm("您确定要退出登录吗？",{type:"warning"}).then(function(){var s=function(s){return 200!==s.code?(e.message(s.message,"warning"),!1):(o.remove("user"),void e.message("退出登录","success",function(){setTimeout(function(){window.location.reload()},1300)}))};o.ajax(t.loginout,"post",{},s)})},submitForm:function(e,s){console.log(e);var r=this;this.$refs[e].validate(function(e){return e?void("login"===s?r.login_do_submit():"forget"===s?r.forget_do_submit():"register"===s&&r.register_do_submit()):(console.log("error submit!!"),!1)})},login_do_submit:function(){this.submit.loading=!0,this.submit.loginText="登录中...";var e=t.login,s=this,r={username:this.loginRuleForm.username,password:this.loginRuleForm.pwd},i=function(e){return s.submit.loading=!1,s.submit.loginText="登录",200!==e.code?(s.message(e.msg,"error"),!1):(o.sets("user",e.data),void s.message("登录成功","success",function(){setTimeout(function(){window.location.reload()},1300)}))};o.ajax(e,"post",r,i)},forget_do_submit:function(){var e=this;this.submit.loading=!0,this.submit.forgetText="信息提交中...";var s=t.resetPassword,r={mobile:this.forgetRuleForm.mobile,password:this.forgetRuleForm.password,mobileCode:this.forgetRuleForm.code},i=function(s){return e.submit.loading=!1,e.submit.forgetText="提交",200!==s.code?(e.message(s.message,"error"),!1):(e.message("修改成功","success"),void e.showLogin())};o.ajax(s,"post",r,i)},register_do_submit:function(){this.submit.loading=!0,this.submit.registerText="信息提交中...";var e=this,s=t.register,r={mobile:this.registerRuleForm.mobile,mobileCode:this.registerRuleForm.code,password:this.registerRuleForm.password},i=function(s){return e.submit.loading=!1,e.submit.registerText="注册",200!==s.code?(e.message(s.message,"error"),!1):(e.message("注册成功","success"),void e.showLogin())};o.ajax(s,"post",r,i)},doGetCode:function(e){if("获取验证码"!==this.submit.getCode)return!1;var s;if("1"===e?s=this.registerRuleForm.mobile.trim():"2"===e&&(s=this.forgetRuleForm.mobile.trim()),""===s)return this.message("请填写手机号","error"),!1;if(!/^1[34578]\d{9}$/.test(s))return this.message("请输入正确的手机号","error"),!1;var r=this,i=t.sendCode,n={mobile:s,type:e},g=function(e){if(200!==e.code)return r.message(e.message,"error"),!1;var s=60;r.message("验证码发送成功","success"),r.submit.getCode="60s";var o=function(){"1s"!==r.submit.getCode&&s>0?(s--,r.submit.getCode=s+"s"):(window.clearInterval(t),r.submit.getCode="获取验证码",s=60)},t=window.setInterval(o,1e3)};o.ajax(i,"post",n,g)},showLogin:function(){this.login=!0,this.forget=!1,this.register=!1,this.submit.formTitle="登录",this.resetForm("loginRuleForm")},showForget:function(){this.forget=!0,this.login=!1,this.register=!1,this.submit.formTitle="忘记密码",this.resetForm("forgetRuleForm")},showRegister:function(){this.register=!0,this.forget=!1,this.login=!1,this.submit.formTitle="注册",this.resetForm("registerRuleForm")},resetForm:function(e){var s=this;setTimeout(function(){s.$refs[e].resetFields()},200)},message:function(e,s,r){this.$message(r?{message:e,type:s,duration:2e3,onClose:r()}:{message:e,type:s})}}})}r.exports=function(e){jQuery(e.regForm).validator({login:function(e){e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1;var s=this.isFormValid();$.when(s).then(function(){if(s){$("#getMobileCode").addClass("am-disabled"),$("#mobile_register_submit").addClass("am-disabled");var e=$("#reg-mobile").val(),r=$("#reg-pwd").val(),i=$("#reg-verify").val(),n=t.register,g={mobileCode:i,mobile:e,password:r},a=function(e){200===e.code?o.message(e.message,"success",function(){window.location.href="/aldbim/download.html"}):($("#getMobileCode").removeClass("am-disabled"),$("#mobile_register_submit").removeClass("am-disabled"),o.message(e.message,"danger"))};alert("12"),o.ajax(n,"post",g,a)}else console.log("submit error")},function(){console.log("submit error")})}})}});